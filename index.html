<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aila + Abhiraj ‚Äî 1 Month Anniversary</title>
  <style>
    :root{
      --bg1:#7c3aed;
      --bg2:#ff2d55;
      --bg3:#ffd6e0;
      --card:#ffffffee;
      --ink:#141417;
      --muted:#5c5c66;
      --accent:#ff2d55;
      --good:#19c37d;
      --warn:#ff9500;
      --shadow: 0 18px 55px rgba(0,0,0,.22);
      --r: 22px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 700px at 18% 18%, var(--bg3) 0%, transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      overflow:auto;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 16px 0;
      color:var(--ink);
    }
    .wrap{ width:min(1040px, 94vw); }
    .card{
      background:var(--card);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:18px;
      position:relative;
      overflow:auto;
      backdrop-filter: blur(7px);
      max-height: calc(100vh - 32px);
    }

    /* floating background */
    .float{ position:absolute; inset:0; pointer-events:none; opacity:.16; }
    .float span{ position:absolute; animation: drift linear infinite; user-select:none; will-change:transform; }
    @keyframes drift{
      from{ transform: translateY(110vh) rotate(0deg); }
      to  { transform: translateY(-20vh) rotate(360deg); }
    }

    .top{
      display:flex; flex-wrap:wrap; gap:10px;
      align-items:center; justify-content:space-between;
      margin-bottom:10px;
      position:relative; z-index:2;
    }
    .pill{
      font-size:12px; padding:6px 10px; border-radius:999px;
      background:#0000000a; border:1px solid #00000014;
      white-space:nowrap; display:inline-flex; gap:8px; align-items:center;
      user-select:none;
    }
    .pill strong{ font-weight:900; }

    .grid{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:12px;
      position:relative; z-index:2;
    }
    @media (max-width: 920px){ .grid{ grid-template-columns: 1fr; } }

    .pane{
      background:#fff;
      border:1px solid #00000012;
      border-radius:18px;
      padding:14px;
      box-shadow: 0 10px 24px rgba(0,0,0,.06);
    }

    .title{
      font-size:34px;
      margin: 2px 0 6px;
      letter-spacing:-0.02em;
    }
    .subtitle{
      margin:0 0 10px;
      color:var(--muted);
      font-size:15px;
      line-height:1.35;
    }

    .nav{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .tab{
      font-size:14px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid #00000014;
      background:#00000006;
      cursor:pointer;
      user-select:none;
      transition: transform .14s ease, filter .14s ease;
    }
    .tab:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .tab.active{
      background: #ff2d5516;
      border-color:#ff2d5555;
      font-weight:800;
    }

    .panel{ display:none; margin-top:12px; }
    .panel.show{ display:block; }

    .bar{ height:10px; background:#00000010; border-radius:999px; overflow:hidden; }
    .fill{ height:100%; width:0%; background: linear-gradient(90deg, #ff2d55, #8b5cf6); border-radius:999px; transition: width .35s ease; }
    .hudRow{
      display:flex; justify-content:space-between; gap:10px;
      margin-top:6px; font-size:13px; color:var(--muted);
      flex-wrap:wrap;
    }

    .typingRow{ display:flex; gap:8px; align-items:flex-start; margin-top:12px; }
    .typing{ margin:0; min-height:68px; white-space:pre-wrap; font-size:18px; line-height:1.35; flex:1; }
    .caret{ width:10px; height:1em; border-left:2px solid #111; transform: translateY(4px); animation: blink .9s infinite; }
    @keyframes blink{ 50%{ opacity:0; } }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px; }
    button{
      font-size:16px; padding:11px 14px;
      border:0; border-radius:16px; cursor:pointer;
      transition: transform .18s ease, filter .18s ease;
      user-select:none;
    }
    button:active{ transform: scale(.98); }
    .primary{ background: var(--accent); color:#fff; }
    .primary:hover{ filter: brightness(1.03); transform: translateY(-1px); }
    .ghost{ background:#00000008; border:1px solid #00000014; color:#222; }
    .ghost:hover{ filter: brightness(1.03); transform: translateY(-1px); }
    .ok{ background: var(--good); color:#fff; }
    .danger{ background:#111; color:#fff; }
    button:disabled{ opacity:.55; cursor:not-allowed; transform:none !important; }

    /* quiz */
    .q{ font-weight:900; margin:0 0 8px; }
    .opts{ display:grid; gap:8px; }
    .opt{
      padding:12px; border-radius:14px; border:1px solid #00000014; background:#00000005;
      cursor:pointer; transition: transform .14s ease, filter .14s ease;
      font-size:15px;
    }
    .opt:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .opt.good{ background:#19c37d16; border-color:#19c37d55; }
    .opt.bad{ background:#ff2d5516; border-color:#ff2d5555; }

    /* wheel */
    .wheelWrap{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:center;
    }
    @media (max-width: 720px){ .wheelWrap{ grid-template-columns: 1fr; } }
    canvas{
      width:100%;
      max-width: 360px;
      aspect-ratio: 1/1;
      border-radius: 18px;
      background:#fff;
      border:1px solid #00000012;
      box-shadow: 0 10px 24px rgba(0,0,0,.06);
    }
    .pointer{
      width:0; height:0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 16px solid #111;
      margin: 0 auto 6px;
    }
    .miniCard{
      background:#00000006;
      border:1px solid #00000012;
      border-radius: 16px;
      padding:12px;
    }

    /* story */
    .storyBox{
      border:1px solid #00000012;
      background:#00000006;
      border-radius: 16px;
      padding:12px;
    }
    .storyBtns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .choice{ flex: 1 1 160px; }

    /* bingo */
    .bingoGrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 760px){ .bingoGrid{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 420px){ .bingoGrid{ grid-template-columns: repeat(2, 1fr); } }
    .bingoCell{
      min-height: 76px;
      border-radius:16px;
      border:1px solid #00000014;
      background:#00000005;
      padding:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-size:13px;
      line-height:1.25;
      cursor:pointer;
      user-select:none;
      transition: transform .14s ease, filter .14s ease;
    }
    .bingoCell:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .bingoCell.done{
      background:#19c37d16;
      border-color:#19c37d55;
      font-weight:800;
    }

    /* countdown */
    .countBox{
      display:grid;
      gap:10px;
      border:1px solid #00000012;
      background:#00000006;
      border-radius: 16px;
      padding:12px;
    }
    .timeGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    @media (max-width: 520px){ .timeGrid{ grid-template-columns: repeat(2, 1fr); } }
    .timeCard{
      background:#fff;
      border:1px solid #00000012;
      border-radius:16px;
      padding:12px;
      text-align:center;
    }
    .num{ font-size:26px; font-weight:900; }
    .lbl{ color:var(--muted); font-size:12px; }

    /* tiny things */
    .list{
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .note{
      background:#fff;
      border:1px solid #00000012;
      border-radius: 16px;
      padding:12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.06);
    }
    .note b{ display:block; margin-bottom:6px; }
    .note p{ margin:0; color:var(--muted); line-height:1.35; }

    /* final */
    .cert{
      margin-top:10px;
      background: linear-gradient(135deg, #fff, #fff7f9);
      border:1px solid #00000012;
      border-radius:18px;
      padding:14px;
      box-shadow: 0 10px 24px rgba(0,0,0,.06);
    }
    .stamp{
      display:inline-block;
      padding:8px 12px;
      border:2px dashed var(--good);
      border-radius: 14px;
      color:#0f6b45;
      font-weight:900;
      transform: rotate(-6deg);
      background:#19c37d14;
      width: fit-content;
      margin-top:10px;
    }
    .meter{ background:#00000008; border:1px solid #00000012; border-radius:14px; padding:10px 12px; display:grid; gap:6px; margin-top:10px; }
    .mbar{ height: 10px; background:#00000012; border-radius:999px; overflow:hidden; }
    .mfill{ height:100%; width:0%; background: linear-gradient(90deg, #ff2d55, #8b5cf6); border-radius:999px; transition: width .6s ease; }

    /* toast */
    .toast{
      position: fixed; left:50%; bottom: 18px; transform: translateX(-50%);
      background: #111; color:#fff; padding: 10px 14px; border-radius: 999px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      font-size: 14px; opacity:0; pointer-events:none;
      transition: opacity .2s ease, transform .2s ease; z-index: 99999;
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-4px); }
    .hintBox{
      font-size:13px;
      color:var(--muted);
      margin-top:8px;
      border:1px dashed #0000001c;
      border-radius:16px;
      padding:10px;
      background:#fff;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" id="app">
      <div class="float" id="float"></div>

      <div class="top">
        <div class="pill">‚ú® 1 Month Anniversary Site</div>
        <div class="pill">For: <strong id="whoFor">Aila</strong></div>
        <div class="pill">From: <strong id="whoFrom">Abhiraj</strong></div>
        <div class="pill">Progress: <strong id="progTxt">0%</strong></div>
      </div>

      <div class="grid">
        <!-- MAIN -->
        <div class="pane">
          <div class="title" id="heroTitle">Happy 1 Month üíñ</div>
          <p class="subtitle" id="heroSub">
            A tiny website with mini-games + sweet stuff. Each section unlocks the final surprise. üòÑ
          </p>

          <div class="bar"><div class="fill" id="progressFill"></div></div>
          <div class="hudRow">
            <span id="hudLeft">Section: Home</span>
            <span id="hudRight">Tip: Use the tabs</span>
          </div>

          <div class="typingRow">
            <p class="typing" id="typing"></p><span class="caret" aria-hidden="true"></span>
          </div>

          <div class="nav" id="nav"></div>

          <!-- HOME -->
          <div class="panel show" id="pHome">
            <div class="miniCard">
              <div style="font-weight:900; margin-bottom:6px;">How this works</div>
              <div style="color:var(--muted); line-height:1.45;">
                Open each tab and complete it once:
                <ul style="margin:8px 0 0; padding-left:18px;">
                  <li>Memory Lane Quiz ‚úÖ</li>
                  <li>Spin-the-Wheel Date Chooser ‚úÖ</li>
                  <li>Choose-Your-Date Story ‚úÖ</li>
                  <li>Anniversary Bingo ‚úÖ</li>
                  <li>Countdown + Surprise Reveal ‚úÖ</li>
                  <li>Tiny Things I Noticed ‚úÖ</li>
                </ul>
                When you‚Äôve done enough, the <b>Final Surprise</b> unlocks.
              </div>
            </div>

            <div class="actions">
              <button class="primary" id="btnStart">Start ü•≥</button>
              <button class="ghost" id="btnResetAll">Reset Progress</button>
              <button class="ghost" id="btnCopyLinkText">Copy a cute message</button>
            </div>

            <div class="hintBox" id="homeHint">
              You can customize the content at the top of the JS (names, date/time, quiz questions, bingo items, notes).
            </div>
          </div>

          <!-- QUIZ -->
          <div class="panel" id="pQuiz">
            <p class="q" id="qText">Question</p>
            <div class="opts" id="opts"></div>
            <div class="hudRow">
              <span>Quiz progress: <b id="qProg">0/0</b></span>
              <span id="quizStatus"></span>
            </div>
          </div>

          <!-- WHEEL -->
          <div class="panel" id="pWheel">
            <div class="wheelWrap">
              <div>
                <div class="pointer"></div>
                <canvas id="wheel" width="600" height="600"></canvas>
              </div>
              <div class="miniCard">
                <div style="font-weight:900; margin-bottom:6px;">Spin-the-Wheel Date Chooser üé°</div>
                <div style="color:var(--muted); line-height:1.45;">
                  Spin once to pick a date idea. You can re-spin, but only if you admit you‚Äôre nervous üòÑ
                </div>
                <div class="actions">
                  <button class="primary" id="btnSpin">Spin üéØ</button>
                  <button class="ghost" id="btnRespin">Re-spin üòÖ</button>
                </div>
                <div class="hintBox">
                  Result: <b id="wheelResult">‚Äî</b><br/>
                  Saved pick: <b id="wheelSaved">‚Äî</b>
                </div>
              </div>
            </div>
          </div>

          <!-- STORY -->
          <div class="panel" id="pStory">
            <div class="storyBox">
              <div style="font-weight:900;" id="storyTitle">Choose Your Date Story üìñ</div>
              <div style="color:var(--muted); line-height:1.45; margin-top:6px;" id="storyBody"></div>
              <div class="storyBtns" id="storyBtns"></div>
            </div>
          </div>

          <!-- BINGO -->
          <div class="panel" id="pBingo">
            <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px;">
              <div>
                <div style="font-weight:900;">Anniversary Bingo ‚úÖ</div>
                <div style="color:var(--muted); font-size:14px;">Tap squares to mark. Get <b id="bingoNeed">8</b> done to complete.</div>
              </div>
              <div class="pill">Done: <strong id="bingoDone">0</strong>/<span id="bingoTotal">0</span></div>
            </div>
            <div class="bingoGrid" id="bingoGrid"></div>
            <div class="actions">
              <button class="ghost" id="btnBingoClear">Clear Bingo</button>
            </div>
          </div>

          <!-- COUNTDOWN -->
          <div class="panel" id="pCountdown">
            <div class="countBox">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
                <div>
                  <div style="font-weight:900;">Countdown to our date ‚è≥</div>
                  <div style="color:var(--muted); font-size:14px;">When it hits zero, the surprise reveals.</div>
                </div>
                <div class="pill">Target: <strong id="targetTxt">‚Äî</strong></div>
              </div>

              <div class="timeGrid">
                <div class="timeCard"><div class="num" id="d">0</div><div class="lbl">Days</div></div>
                <div class="timeCard"><div class="num" id="h">0</div><div class="lbl">Hours</div></div>
                <div class="timeCard"><div class="num" id="m">0</div><div class="lbl">Minutes</div></div>
                <div class="timeCard"><div class="num" id="s">0</div><div class="lbl">Seconds</div></div>
              </div>

              <div class="miniCard" id="revealBox" style="display:none;">
                <div style="font-weight:900;">Surprise Reveal üéÅ</div>
                <div style="color:var(--muted); line-height:1.45; margin-top:6px;" id="revealText"></div>
                <div class="actions">
                  <button class="ok" id="btnRevealDone">Mark as done ‚úÖ</button>
                </div>
              </div>

              <div class="hintBox">
                If you want it to unlock immediately, set the target time in the JS to a past time.
              </div>
            </div>
          </div>

          <!-- TINY THINGS -->
          <div class="panel" id="pTiny">
            <div style="font-weight:900;">Tiny things I noticed about you ‚ú®</div>
            <div style="color:var(--muted); margin-top:6px; line-height:1.45;">
              These are small, but they‚Äôre the reason this month felt big.
            </div>
            <div class="list" id="tinyList"></div>
            <div class="actions">
              <button class="ok" id="btnTinyDone">I read them ‚úÖ</button>
            </div>
          </div>

          <!-- FINAL -->
          <div class="panel" id="pFinal">
            <div class="cert">
              <div style="font-size:18px; line-height:1.45;">
                <b>Happy 1 Month, Aila.</b><br/>
                This was my way of saying: I‚Äôm really happy it‚Äôs you. üíñ
              </div>

              <div class="stamp" id="finalStamp">‚úÖ MATCH FOUND: AILA + ABHIRAJ</div>

              <div class="meter">
                <div><b>Month 1 rating</b>: <span id="m1">loading‚Ä¶</span></div>
                <div class="mbar"><div class="mfill" id="b1"></div></div>
              </div>
              <div class="meter">
                <div><b>Laugh compatibility</b>: <span id="m2">loading‚Ä¶</span></div>
                <div class="mbar"><div class="mfill" id="b2"></div></div>
              </div>
              <div class="meter">
                <div><b>Future date probability</b>: <span id="m3">loading‚Ä¶</span></div>
                <div class="mbar"><div class="mfill" id="b3"></div></div>
              </div>

              <div class="miniCard" style="margin-top:12px;">
                <div style="font-weight:900;">Your saved date pick</div>
                <div style="color:var(--muted); margin-top:6px;" id="finalDatePick">‚Äî</div>
              </div>

              <div class="actions" style="margin-top:12px;">
                <button class="ok" id="btnHearts">Confirm üíñ</button>
                <button class="ghost" id="btnCopyMsg">Copy message</button>
                <button class="danger" id="btnLockAgain">Lock again (prank)</button>
              </div>
            </div>
          </div>

        </div>

        <!-- SIDE -->
        <div class="pane">
          <div style="font-weight:900; margin-bottom:8px;">Checklist</div>
          <div class="miniCard" style="display:grid; gap:8px;">
            <div>üß† Quiz: <b id="cQuiz">‚ùå</b></div>
            <div>üé° Wheel: <b id="cWheel">‚ùå</b></div>
            <div>üìñ Story: <b id="cStory">‚ùå</b></div>
            <div>‚úÖ Bingo: <b id="cBingo">‚ùå</b></div>
            <div>‚è≥ Countdown: <b id="cCount">‚ùå</b></div>
            <div>‚ú® Tiny things: <b id="cTiny">‚ùå</b></div>
            <div style="border-top:1px solid #00000012; padding-top:8px;">
              Final: <b id="cFinal">üîí Locked</b>
            </div>
          </div>

          <div style="margin-top:12px;" class="miniCard">
            <div style="font-weight:900;">Quick tips</div>
            <ul style="margin:8px 0 0; padding-left:18px; color:var(--muted); line-height:1.45; font-size:14px;">
              <li>Edit the <b>CONFIG</b> in JS to personalize.</li>
              <li>GitHub Pages sometimes caches ‚Äî hard refresh: <b>Cmd+Shift+R</b>.</li>
              <li>Bingo saves state in your browser (localStorage).</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">OK</div>

  <script>
    /***********************
     * CONFIG ‚Äî EDIT ME ‚úÖ
     ***********************/
    const CONFIG = {
      forName: "Aila",
      fromName: "Abhiraj",
      // Countdown target (local time). Example: "2026-02-14T19:30:00"
      // If you want it to unlock immediately, set this to a past date/time.
      countdownTargetISO: "2026-02-14T19:30:00",

      revealMessage: "Surprise plan: I‚Äôm taking you out ‚Äî your saved date pick is locked in. Dress comfy, bring your smile, and keep your schedule suspiciously open. üòÑ",

      // Quiz questions (edit answers to match YOUR memories)
      quiz: [
        { q: "What was I wearing when we first met / first went out?", o: ["A black outfit", "A hoodie", "A shirt you liked"], a: 0 },
        { q: "What is our first inside joke?", o: ["The ‚Äò___‚Äô joke", "The ‚Äò___‚Äô moment", "The ‚Äò___‚Äô text"], a: 1 },
        { q: "What‚Äôs my favorite thing about you?", o: ["Your laugh", "Your eyes", "Your attitude (in a cute way)"], a: 0 },
      ],

      // Wheel options
      wheelOptions: ["Coffee date ‚òï", "Dinner date üçù", "Dessert-first üç∞", "Movie + snacks üé¨", "Walk + talk üåô", "Arcade challenge üéÆ"],

      // Story (simple branching)
      story: {
        start: {
          title: "Choose Your Date Story üìñ",
          body: "You open a mystery envelope. It says: ‚ÄòHappy 1 month.‚Äô\nPick the vibe for today:",
          choices: [
            { label: "Cute & calm", next: "calm" },
            { label: "Fun & chaotic", next: "chaos" },
            { label: "Romantic & soft", next: "soft" },
          ]
        },
        calm: {
          title: "Cute & calm üåô",
          body: "We go somewhere cozy, talk about everything and nothing, and end with dessert.\nQuestion: what do you want first?",
          choices: [
            { label: "Coffee ‚òï", next: "endCoffee" },
            { label: "Dessert üç∞", next: "endDessert" },
          ]
        },
        chaos: {
          title: "Fun & chaotic üéÆ",
          body: "We compete in something silly (arcade / bowling / anything) and the loser has to say 3 compliments out loud.",
          choices: [
            { label: "I‚Äôm winning üòå", next: "endWin" },
            { label: "You‚Äôre winning üòÑ", next: "endLose" },
          ]
        },
        soft: {
          title: "Romantic & soft üíñ",
          body: "We take cute photos, hold hands, and I say something cheesy on purpose.\nPick the setting:",
          choices: [
            { label: "Sunset walk üåá", next: "endSunset" },
            { label: "Dinner date üçù", next: "endDinner" },
          ]
        },
        endCoffee: { title:"Ending", body:"Ending unlocked: Coffee + long talk + a tiny surprise.\n\n(Approved.)", done:true },
        endDessert:{ title:"Ending", body:"Ending unlocked: Dessert first because priorities.\n\n(Strong choice.)", done:true },
        endWin:    { title:"Ending", body:"Ending unlocked: You win. I pretend to be mad. We both laugh.\n\n(Perfect.)", done:true },
        endLose:   { title:"Ending", body:"Ending unlocked: I win. You demand a rematch.\n\n(We do a rematch.)", done:true },
        endSunset: { title:"Ending", body:"Ending unlocked: Sunset walk + cute photos + ‚Äòone more minute‚Äô.\n\n(Soft.)", done:true },
        endDinner: { title:"Ending", body:"Ending unlocked: Dinner date + dessert + a calm hug.\n\n(Yes.)", done:true },
      },

      // Bingo items (tap to mark)
      bingoNeed: 8,
      bingoItems: [
        "Hold hands",
        "Take a cute pic",
        "Say 1 cheesy line",
        "Share dessert",
        "Compliment each other",
        "Mini walk",
        "Laugh out loud",
        "One ‚Äòus‚Äô selfie",
        "Try a new place",
        "Make a small plan",
        "A long hug",
        "Silly game",
        "Tell a memory",
        "Favorite song moment",
        "‚ÄòI like you‚Äô (again)",
      ],

      // Tiny things list
      tinyThings: [
        { title: "Your laugh", text: "It changes the whole mood of a day. Like it flips the ‚Äògood‚Äô switch." },
        { title: "How you text", text: "Even one short message from you feels like a little win." },
        { title: "Your expressions", text: "When you‚Äôre pretending to be serious but you‚Äôre about to smile ‚Äî I notice." },
        { title: "Your kindness", text: "The way you care shows up in small moments, and that‚Äôs the best kind." },
        { title: "Your vibe", text: "You make normal things feel more fun. Effortlessly." },
      ],
    };

    /***********************
     * APP LOGIC
     ***********************/
    const $ = (id)=>document.getElementById(id);
    const toastEl = $("toast");
    let toastTimer;
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toastEl.classList.remove("show"), 1100);
    }
    function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

    // Typewriter
    const typingEl = $("typing");
    let typingTimer = null;
    function typeLine(text, cb){
      clearInterval(typingTimer);
      typingEl.textContent = "";
      let i=0;
      const speed = 14 + Math.random()*10;
      typingTimer = setInterval(()=>{
        typingEl.textContent += text[i] ?? "";
        i++;
        if(i > text.length){
          clearInterval(typingTimer);
          cb && cb();
        }
      }, speed);
    }

    // Floating emojis
    (function makeFloat(){
      const f = $("float");
      const emojis = ["üíñ","üíó","üíò","üíû","üåπ","‚ú®","üçì","üéÄ"];
      for(let i=0;i<22;i++){
        const s=document.createElement("span");
        s.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        s.style.left = (Math.random()*100) + "%";
        s.style.animationDuration = (10 + Math.random()*14) + "s";
        s.style.animationDelay = (-Math.random()*18) + "s";
        s.style.fontSize = (18 + Math.random()*22) + "px";
        f.appendChild(s);
      }
    })();

    // Names
    $("whoFor").textContent = CONFIG.forName;
    $("whoFrom").textContent = CONFIG.fromName;
    $("heroTitle").textContent = `Happy 1 Month, ${CONFIG.forName} üíñ`;
    $("heroSub").innerHTML = `A tiny website with mini-games + sweet stuff. Made by <b>${CONFIG.fromName}</b>.`;

    // Tabs
    const TABS = [
      { id:"pHome", label:"Home" },
      { id:"pQuiz", label:"Memory Quiz" },
      { id:"pWheel", label:"Spin Wheel" },
      { id:"pStory", label:"Story" },
      { id:"pBingo", label:"Bingo" },
      { id:"pCountdown", label:"Countdown" },
      { id:"pTiny", label:"Tiny Things" },
      { id:"pFinal", label:"Final Surprise" },
    ];
    const nav = $("nav");

    function showPanel(id){
      TABS.forEach(t => $(t.id).classList.remove("show"));
      $(id).classList.add("show");

      [...nav.children].forEach(b => b.classList.remove("active"));
      const btn = [...nav.children].find(b => b.dataset.target === id);
      if(btn) btn.classList.add("active");

      const name = TABS.find(t=>t.id===id)?.label || "‚Äî";
      $("hudLeft").textContent = `Section: ${name}`;

      // prevent going to final if locked
      if(id === "pFinal" && !isFinalUnlocked()){
        toast("Final is locked üîí Complete sections first!");
        showPanel("pHome");
      }
    }

    TABS.forEach((t, i)=>{
      const b = document.createElement("div");
      b.className = "tab";
      b.textContent = t.label;
      b.dataset.target = t.id;
      b.onclick = ()=> showPanel(t.id);
      nav.appendChild(b);
      if(i===0) b.classList.add("active");
    });

    // Progress state (localStorage)
    const KEY = "oneMonthSite_v1";
    function loadState(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return {
          quizDone:false, wheelDone:false, storyDone:false,
          bingoDone:false, countDone:false, tinyDone:false,
          wheelSaved:null,
          bingoMarks: Array(CONFIG.bingoItems.length).fill(false),
        };
        const s = JSON.parse(raw);
        // ensure length
        if(!Array.isArray(s.bingoMarks) || s.bingoMarks.length !== CONFIG.bingoItems.length){
          s.bingoMarks = Array(CONFIG.bingoItems.length).fill(false);
        }
        return s;
      } catch(e){
        return {
          quizDone:false, wheelDone:false, storyDone:false,
          bingoDone:false, countDone:false, tinyDone:false,
          wheelSaved:null,
          bingoMarks: Array(CONFIG.bingoItems.length).fill(false),
        };
      }
    }
    function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); }
    let state = loadState();

    function isFinalUnlocked(){
      // require at least 5/6 sections done (you can change this rule)
      const doneCount = ["quizDone","wheelDone","storyDone","bingoDone","countDone","tinyDone"].filter(k=>state[k]).length;
      return doneCount >= 5;
    }

    function updateChecklist(){
      $("cQuiz").textContent = state.quizDone ? "‚úÖ" : "‚ùå";
      $("cWheel").textContent = state.wheelDone ? "‚úÖ" : "‚ùå";
      $("cStory").textContent = state.storyDone ? "‚úÖ" : "‚ùå";
      $("cBingo").textContent = state.bingoDone ? "‚úÖ" : "‚ùå";
      $("cCount").textContent = state.countDone ? "‚úÖ" : "‚ùå";
      $("cTiny").textContent = state.tinyDone ? "‚úÖ" : "‚ùå";
      $("cFinal").textContent = isFinalUnlocked() ? "üîì Unlocked" : "üîí Locked";
    }

    function updateProgressBar(){
      const total = 6;
      const done = ["quizDone","wheelDone","storyDone","bingoDone","countDone","tinyDone"].filter(k=>state[k]).length;
      const pct = Math.round((done/total)*100);
      $("progTxt").textContent = pct + "%";
      $("progressFill").style.width = pct + "%";
      $("hudRight").textContent = isFinalUnlocked() ? "Final is unlocked ‚úÖ" : `Complete ${Math.max(0, 5-done)} more section(s) to unlock final`;
      updateChecklist();
    }

    // HOME actions
    $("btnStart").onclick = ()=>{
      toast("Let‚Äôs go üòÑ");
      typeLine(`Hi ${CONFIG.forName} üíñ\nThis is our 1-month mini-site.\nStart with the Memory Quiz.`);
      showPanel("pQuiz");
    };

    $("btnResetAll").onclick = ()=>{
      if(!confirm("Reset all progress?")) return;
      localStorage.removeItem(KEY);
      state = loadState();
      toast("Reset ‚úÖ");
      updateProgressBar();
      setupBingo();
      setWheelSavedText();
      resetQuiz();
      setStory(CONFIG.story.start);
      updateCountdown();
      showPanel("pHome");
      typeLine(`Reset complete.\n${CONFIG.forName}, you‚Äôve been granted a fresh run üòÑ`);
    };

    $("btnCopyLinkText").onclick = async ()=>{
      const msg = `I made a 1-month anniversary mini-site for you üíñ\nOpen it when you‚Äôre free.\n\n‚Äî ${CONFIG.fromName}`;
      await copyText(msg);
      toast("Copied ‚úÖ");
    };

    // QUIZ
    let qIdx = 0;
    function resetQuiz(){
      qIdx = 0;
      renderQuiz();
      $("quizStatus").textContent = state.quizDone ? "‚úÖ Completed" : "";
    }

    function renderQuiz(){
      const q = CONFIG.quiz[qIdx];
      $("qProg").textContent = `${Math.min(qIdx, CONFIG.quiz.length)}/${CONFIG.quiz.length}`;
      $("qText").textContent = q ? q.q : "Quiz complete ‚úÖ";
      const opts = $("opts");
      opts.innerHTML = "";

      if(!q){
        state.quizDone = true;
        saveState();
        updateProgressBar();
        $("quizStatus").textContent = "‚úÖ Completed";
        toast("Quiz completed ‚úÖ");
        typeLine("Nice üòÑ\nNext: spin the wheel!");
        return;
      }

      q.o.forEach((label, i)=>{
        const b = document.createElement("div");
        b.className = "opt";
        b.textContent = label;
        b.onclick = ()=>{
          if(i === q.a){
            b.classList.add("good");
            toast("Correct ‚úÖ");
            setTimeout(()=>{
              qIdx++;
              renderQuiz();
              if(qIdx >= CONFIG.quiz.length){
                $("qProg").textContent = `${CONFIG.quiz.length}/${CONFIG.quiz.length}`;
              } else {
                $("qProg").textContent = `${qIdx}/${CONFIG.quiz.length}`;
              }
            }, 220);
          } else {
            b.classList.add("bad");
            toast("Close üòÑ");
            setTimeout(()=>b.classList.remove("bad"), 450);
          }
        };
        opts.appendChild(b);
      });
    }

    // WHEEL
    const wheelCanvas = $("wheel");
    const ctx = wheelCanvas.getContext("2d");
    let wheelAngle = 0;
    let spinning = false;
    let wheelResult = null;

    function setWheelSavedText(){
      $("wheelSaved").textContent = state.wheelSaved || "‚Äî";
      $("finalDatePick").textContent = state.wheelSaved || "No saved pick yet ‚Äî spin the wheel üòÑ";
    }

    function drawWheel(){
      const opts = CONFIG.wheelOptions;
      const n = opts.length;
      const cx = wheelCanvas.width/2;
      const cy = wheelCanvas.height/2;
      const r = Math.min(cx,cy) - 18;

      ctx.clearRect(0,0,wheelCanvas.width,wheelCanvas.height);

      // background
      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(wheelAngle);

      for(let i=0;i<n;i++){
        const a0 = (i * 2*Math.PI)/n;
        const a1 = ((i+1) * 2*Math.PI)/n;

        // alternating simple colors
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.arc(0,0,r,a0,a1);
        ctx.closePath();
        ctx.fillStyle = (i % 2 === 0) ? "rgba(255,45,85,0.15)" : "rgba(139,92,246,0.12)";
        ctx.fill();
        ctx.strokeStyle = "rgba(0,0,0,0.07)";
        ctx.stroke();

        // text
        ctx.save();
        ctx.rotate((a0+a1)/2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#111";
        ctx.font = "bold 22px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText(opts[i], r-14, 8);
        ctx.restore();
      }

      // center
      ctx.beginPath();
      ctx.arc(0,0,52,0,Math.PI*2);
      ctx.fillStyle = "#fff";
      ctx.fill();
      ctx.strokeStyle = "rgba(0,0,0,0.10)";
      ctx.stroke();

      ctx.fillStyle = "#111";
      ctx.font = "900 18px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "center";
      ctx.fillText("SPIN", 0, 6);

      ctx.restore();
    }

    function getWheelPick(){
      const n = CONFIG.wheelOptions.length;
      // pointer is at top (angle 0). Convert wheelAngle to index.
      let a = (-wheelAngle) % (2*Math.PI);
      if(a < 0) a += 2*Math.PI;
      const slice = (2*Math.PI)/n;
      const idx = Math.floor(a / slice);
      return CONFIG.wheelOptions[idx];
    }

    function spin(){
      if(spinning) return;
      spinning = true;
      wheelResult = null;
      $("wheelResult").textContent = "Spinning‚Ä¶";

      const extra = (Math.random()*5 + 6) * 2*Math.PI; // lots of spins
      const target = wheelAngle + extra + (Math.random()*0.7);
      const start = wheelAngle;
      const dur = 1800 + Math.random()*800;
      const t0 = performance.now();

      function anim(t){
        const p = Math.min(1, (t - t0)/dur);
        // easeOutCubic
        const e = 1 - Math.pow(1-p, 3);
        wheelAngle = start + (target - start) * e;
        drawWheel();
        if(p < 1){
          requestAnimationFrame(anim);
        } else {
          spinning = false;
          wheelResult = getWheelPick();
          $("wheelResult").textContent = wheelResult;
          toast("Wheel picked ‚úÖ");

          // mark done + save choice
          state.wheelDone = true;
          state.wheelSaved = wheelResult;
          saveState();
          updateProgressBar();
          setWheelSavedText();

          typeLine("Okay that‚Äôs cute.\nNext: the story tab üòÑ");
        }
      }
      requestAnimationFrame(anim);
    }

    $("btnSpin").onclick = spin;
    $("btnRespin").onclick = ()=>{
      if(spinning) return;
      toast("Re-spin granted üòÑ");
      spin();
    };

    // STORY
    let storyNodeKey = "start";
    function setStory(node){
      $("storyTitle").textContent = node.title;
      $("storyBody").textContent = node.body;
      const box = $("storyBtns");
      box.innerHTML = "";

      if(node.done){
        const doneBtn = document.createElement("button");
        doneBtn.className = "ok choice";
        doneBtn.textContent = "Finish story ‚úÖ";
        doneBtn.onclick = ()=>{
          state.storyDone = true;
          saveState();
          updateProgressBar();
          toast("Story completed ‚úÖ");
          typeLine("That ending was‚Ä¶ very you.\nNext: Bingo üòÑ");
        };
        box.appendChild(doneBtn);
        return;
      }

      node.choices.forEach(ch=>{
        const b = document.createElement("button");
        b.className = "ghost choice";
        b.textContent = ch.label;
        b.onclick = ()=>{
          storyNodeKey = ch.next;
          setStory(CONFIG.story[ch.next]);
          if(CONFIG.story[ch.next]?.done){
            toast("Ending unlocked üéâ");
          } else {
            toast("Choice saved ‚úÖ");
          }
        };
        box.appendChild(b);
      });
    }

    // BINGO
    function setupBingo(){
      $("bingoNeed").textContent = CONFIG.bingoNeed;
      $("bingoTotal").textContent = CONFIG.bingoItems.length;
      const grid = $("bingoGrid");
      grid.innerHTML = "";

      CONFIG.bingoItems.forEach((txt, i)=>{
        const cell = document.createElement("div");
        cell.className = "bingoCell";
        cell.textContent = txt;
        if(state.bingoMarks[i]) cell.classList.add("done");

        cell.onclick = ()=>{
          state.bingoMarks[i] = !state.bingoMarks[i];
          cell.classList.toggle("done", state.bingoMarks[i]);
          saveState();
          updateBingoCount();
        };
        grid.appendChild(cell);
      });

      updateBingoCount();
    }

    function updateBingoCount(){
      const done = state.bingoMarks.filter(Boolean).length;
      $("bingoDone").textContent = done;

      if(done >= CONFIG.bingoNeed && !state.bingoDone){
        state.bingoDone = true;
        saveState();
        toast("Bingo completed ‚úÖ");
        typeLine("Bingo cleared üòÑ\nNext: Countdown.");
      }
      updateProgressBar();
    }

    $("btnBingoClear").onclick = ()=>{
      if(!confirm("Clear bingo marks?")) return;
      state.bingoMarks = Array(CONFIG.bingoItems.length).fill(false);
      state.bingoDone = false;
      saveState();
      setupBingo();
      toast("Cleared ‚úÖ");
    };

    // COUNTDOWN
    const targetDate = new Date(CONFIG.countdownTargetISO);
    $("targetTxt").textContent = targetDate.toLocaleString();

    function updateCountdown(){
      const now = new Date();
      const diff = targetDate.getTime() - now.getTime();

      if(diff <= 0){
        $("d").textContent = "0";
        $("h").textContent = "0";
        $("m").textContent = "0";
        $("s").textContent = "0";

        $("revealBox").style.display = "block";
        $("revealText").textContent = CONFIG.revealMessage;

        if(!state.countDone){
          // not auto-completing until they press "done"
          // (so they actually see the reveal)
        }
        return;
      }

      const sec = Math.floor(diff/1000);
      const days = Math.floor(sec / 86400);
      const hours = Math.floor((sec % 86400) / 3600);
      const mins = Math.floor((sec % 3600) / 60);
      const secs = sec % 60;

      $("d").textContent = String(days);
      $("h").textContent = String(hours);
      $("m").textContent = String(mins);
      $("s").textContent = String(secs);

      $("revealBox").style.display = "none";
    }

    $("btnRevealDone").onclick = ()=>{
      state.countDone = true;
      saveState();
      updateProgressBar();
      toast("Reveal completed ‚úÖ");
      typeLine("Okay now‚Ä¶ Tiny Things tab ü•∫");
    };

    setInterval(updateCountdown, 1000);

    // TINY THINGS
    function renderTiny(){
      const list = $("tinyList");
      list.innerHTML = "";
      CONFIG.tinyThings.forEach(item=>{
        const d = document.createElement("div");
        d.className = "note";
        d.innerHTML = `<b>${item.title}</b><p>${item.text}</p>`;
        list.appendChild(d);
      });
    }
    $("btnTinyDone").onclick = ()=>{
      state.tinyDone = true;
      saveState();
      updateProgressBar();
      toast("Aww ‚úÖ");
      typeLine("Tiny things done.\nFinal might be unlocked now üëÄ");
    };

    // FINAL
    function animateFinalMeters(){
      const bars = [
        ["b1","m1", 95, 100, 120],
        ["b2","m2", 90, 100, 320],
        ["b3","m3", 92, 100, 520],
      ];
      bars.forEach(([bar, label, min, max, delay])=>{
        setTimeout(()=>{
          const v = rand(min,max);
          $(label).textContent = v + "%";
          requestAnimationFrame(()=> $(bar).style.width = v + "%");
        }, delay);
      });
    }

    $("btnHearts").onclick = ()=>{
      toast("Confirmed üíñ");
      typeLine(`Happy 1 month, ${CONFIG.forName}.\nFrom: ${CONFIG.fromName} üíñ`);
    };

    $("btnCopyMsg").onclick = async ()=>{
      const pick = state.wheelSaved ? `\nSaved date pick: ${state.wheelSaved}` : "";
      const msg =
`${CONFIG.forName} üíñ

Happy 1 month.
I made you a little anniversary website.

${pick}

‚Äî ${CONFIG.fromName}`;
      await copyText(msg);
      toast("Copied ‚úÖ");
    };

    $("btnLockAgain").onclick = ()=>{
      toast("Locked üòÑ");
      showPanel("pHome");
      typeLine("Prank complete.\nOkay okay‚Ä¶ go back to Final üòÑ");
    };

    // Copy helper
    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
      } catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
      }
    }

    // FINAL UI update when unlocked
    function refreshFinalUI(){
      $("finalStamp").textContent = `‚úÖ MATCH FOUND: ${CONFIG.forName.toUpperCase()} + ${CONFIG.fromName.toUpperCase()}`;
      setWheelSavedText();
      if(isFinalUnlocked()){
        animateFinalMeters();
      }
    }

    // Init
    function init(){
      // initial typing
      typeLine(`Hi ${CONFIG.forName} üíñ\nWelcome to our 1-month mini-site.\nStart with Memory Quiz ‚Üí then Wheel ‚Üí then Story ‚Üí Bingo ‚Üí Countdown ‚Üí Tiny Things.`);
      // quiz
      $("qProg").textContent = `0/${CONFIG.quiz.length}`;
      renderQuiz();
      // wheel
      drawWheel();
      setWheelSavedText();
      $("wheelResult").textContent = "‚Äî";
      // story
      setStory(CONFIG.story.start);
      // bingo
      setupBingo();
      // tiny
      renderTiny();
      // countdown
      updateCountdown();
      $("revealText").textContent = CONFIG.revealMessage;

      updateProgressBar();
      refreshFinalUI();
    }

    // If someone tries to open final while locked, the showPanel() will redirect
    // Update final meters if unlock happens later:
    setInterval(()=> {
      refreshFinalUI();
      updateProgressBar();
    }, 1500);

    init();
  </script>
</body>
</html>
